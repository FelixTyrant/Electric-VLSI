<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="all" name="electric">

    <target name="init">
        <property name="beanshell" value="../lib/java/bsh-1.2b3.jar"/>
        <property name="AppleJava" value="AppleJavaExtensions.jar"/>
    </target>

    <target depends="init" name="compile">
        <!-- Both srcdir and destdir should be package roots. -->
        <!-- They could be different of course; in that case NetBeans can also be set -->
        <!-- up to compile to a different filesystem in the same way; see Compiler Types: -->
        <javac debug="true" deprecation="true" destdir="." srcdir=".">
            <!-- To add something to the classpath: -->
            <classpath><pathelement location="${beanshell}"/></classpath>
            <classpath><pathelement location="${AppleJava}"/></classpath>
            <!-- To exclude some files: -->
            <exclude name="intervalsimulation/"/>
        </javac>
    </target>

        <target depends="init,compile" name="run">
        <java classname="com.sun.electric.Main" failonerror="true" fork="true" maxmemory="1024m">
            <classpath>
                <pathelement location="."/>
                <pathelement location="${beanshell}"/>
                <pathelement location="${AppleJava}"/>
           </classpath>
            <!-- Pass some args, perhaps: -->
            <!-- arg value="-myfile"/ -->
            <!-- Will be given as an absolute path: -->
            <!-- arg file="myfile.txt"/ -->
        </java>
    </target>

    <target depends="init,compile" description="Make binary Jar file" name="jar">
        <!-- To make a standalone app: -->
        <!-- 1. Create electric.mf manifest. -->
        <!-- 2. Put in it two lines: -->
        <!-- Manifest-Version: 1.0 -->
        <!-- Main-Class: com.sun.electric.Main -->
        <!-- 3. Pass to <jar>: manifest="electric.mf" -->
        <exec executable="jar"><arg line="xf ${beanshell}"></arg></exec> 
        <exec executable="jar"><arg line="xf ${AppleJava}"></arg></exec> 
        <delete dir="META-INF"></delete>
        <jar basedir="." compress="true" jarfile="electric.jar" manifest="electric.mf">
            <!--  <arg line="-J-mx500m"></arg>  -->
            <exclude name="apidoc/"/>
            <exclude name="intervalsimulation/"/>
            <exclude name="build.xml"/>
            <exclude name="electric.jar"/>
            <exclude name="electric.mf"/>
            <exclude name="Hack_stack.txt"/>
            <exclude name="*.group"/>
            <exclude name="**/.nbattrs"/>
            <exclude name="**/*.java"/>
            <exclude name="**/*.form"/>
        </jar>
        <delete dir="bsh"></delete>
        <delete dir="com/apple"></delete>
    </target>

    <target depends="init,compile" description="Make source Jar file" name="jarSource">
        <exec executable="jar"><arg line="xf ${beanshell}"></arg></exec> 
        <exec executable="jar"><arg line="xf ${AppleJava}"></arg></exec> 
        <delete dir="META-INF"></delete>
        <jar basedir="." compress="true" jarfile="electric.jar" manifest="electric.mf">
            <!--  <arg line="-J-mx500m"></arg>  -->
            <exclude name="apidoc/"/>
            <exclude name="intervalsimulation/"/>
            <exclude name="electric.jar"/>
            <exclude name="electric.mf"/>
            <exclude name="Hack_stack.txt"/>
            <exclude name="*.group"/>
            <exclude name="**/.nbattrs"/>
        </jar>
        <delete dir="bsh"></delete>
        <delete dir="com/apple"></delete>
    </target>

    <target depends="init,jar" description="Run Jar file" name="testJar">
        <java classname="com.sun.electric.Main" failonerror="true" fork="true" maxmemory="1024m">
            <classpath>
                <pathelement location="."/>
                <pathelement location="${beanshell}"/>
                <pathelement location="${AppleJava}"/>
           </classpath>
            <!-- Pass some args, perhaps: -->
            <!-- arg value="-myfile"/ -->
            <!-- Will be given as an absolute path: -->
            <!-- arg file="myfile.txt"/ -->
        </java>
    </target>

    <target depends="init" description="Create Javadoc" name="javadoc">
        <mkdir dir="apidoc"/>
        <javadoc destdir="apidoc" packagenames="com.sun.electric.*">
            <classpath>
                <pathelement location="${beanshell}"/>
                <pathelement location="${AppleJava}"/>
           </classpath>
           <sourcepath>
                <pathelement location="."/>
            </sourcepath>
        </javadoc>
    </target>

    <target depends="init" description="Clean all build products" name="clean">
        <delete quiet="true">
            <fileset dir=".">
                <include name="**/*.class"/>
            </fileset>
            <fileset dir="../srcjClasses">
                <include name="**/*.class"/>
            </fileset>
        </delete>
    <delete file="electric.jar"/>
        <delete dir="apidoc"/>
    </target>

</project>
